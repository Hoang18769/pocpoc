"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/(home)/layout",{

/***/ "(app-pages-browser)/./src/hooks/useChat.js":
/*!******************************!*\
  !*** ./src/hooks/useChat.js ***!
  \******************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ useChat; }\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(app-pages-browser)/./node_modules/next/dist/compiled/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/utils/axios */ \"(app-pages-browser)/./src/utils/axios.js\");\n/* harmony import */ var _utils_socket__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/utils/socket */ \"(app-pages-browser)/./src/utils/socket.js\");\n/* harmony import */ var react_hot_toast__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! react-hot-toast */ \"(app-pages-browser)/./node_modules/react-hot-toast/dist/index.mjs\");\n/* harmony import */ var _store_ZustandStore__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/store/ZustandStore */ \"(app-pages-browser)/./src/store/ZustandStore.js\");\n/* __next_internal_client_entry_do_not_use__ default auto */ var _s = $RefreshSig$();\n\n\n\n\n\nfunction useChat(chatId) {\n    _s();\n    const [messages, setMessages] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);\n    const [loading, setLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(true);\n    const [currentUserId, setCurrentUserId] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n    const clientRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const subscribedChatIdRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    const intervalRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        const uid = localStorage.getItem(\"userId\");\n        if (uid) setCurrentUserId(uid);\n    }, []);\n    // Hàm helper để cập nhật chatList\n    // Trong useChat hook, sửa updateChatList function:\n    const updateChatList = (newMessage)=>{\n        console.log(\"\\uD83D\\uDD04 Processing message for chatList:\", newMessage);\n        const { chatList } = _store_ZustandStore__WEBPACK_IMPORTED_MODULE_4__[\"default\"].getState();\n        console.log(\"\\uD83D\\uDCDC Current chatList:\", chatList);\n        const foundChat = chatList.find((c)=>c.chatId === chatId);\n        console.log(\"\\uD83D\\uDD0D Found chat:\", foundChat);\n        if (foundChat) {\n            var _newChatList_;\n            console.log(\"\\uD83D\\uDD0D Current latestMessage:\", foundChat.latestMessage); // ⭐ SỬA TÊN FIELD\n            console.log(\"\\uD83C\\uDD95 New message structure:\", {\n                id: newMessage.id,\n                content: newMessage.content,\n                sentAt: newMessage.sentAt,\n                sender: newMessage.sender\n            });\n            const updatedChat = {\n                ...foundChat,\n                // ⭐ SỬA TỪ lastMessage THÀNH latestMessage\n                latestMessage: {\n                    id: newMessage.id,\n                    content: newMessage.content,\n                    sentAt: newMessage.sentAt,\n                    sender: newMessage.sender,\n                    messageType: newMessage.messageType,\n                    attachment: newMessage.attachment,\n                    attachments: newMessage.attachments,\n                    deleted: newMessage.deleted || false\n                },\n                updatedAt: newMessage.sentAt,\n                notReadMessageCount: (foundChat.notReadMessageCount || 0) + (newMessage.isOwnMessage ? 0 : 1)\n            };\n            console.log(\"\\uD83C\\uDD95 UpdatedChat latestMessage:\", updatedChat.latestMessage);\n            const otherChats = chatList.filter((c)=>c.chatId !== chatId);\n            const newChatList = [\n                ...otherChats,\n                updatedChat\n            ].sort((a, b)=>new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n            console.log(\"\\uD83D\\uDCDC New chatList first item latestMessage:\", (_newChatList_ = newChatList[0]) === null || _newChatList_ === void 0 ? void 0 : _newChatList_.latestMessage);\n            // Force update bằng cách tạo object mới hoàn toàn\n            _store_ZustandStore__WEBPACK_IMPORTED_MODULE_4__[\"default\"].setState({\n                chatList: newChatList.map((chat)=>({\n                        ...chat\n                    }))\n            });\n            console.log(\"✅ ChatList updated successfully!\");\n            // Verify update\n            setTimeout(()=>{\n                var _updatedList_find;\n                const { chatList: updatedList } = _store_ZustandStore__WEBPACK_IMPORTED_MODULE_4__[\"default\"].getState();\n                console.log(\"\\uD83D\\uDD0D Verified latestMessage after update:\", (_updatedList_find = updatedList.find((c)=>c.chatId === chatId)) === null || _updatedList_find === void 0 ? void 0 : _updatedList_find.latestMessage);\n            }, 100);\n        } else {\n            console.warn(\"⚠️ Kh\\xf4ng t\\xecm thấy chat với chatId: \".concat(chatId));\n        }\n    };\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        if (!chatId) return;\n        const fetchMessages = async ()=>{\n            try {\n                setLoading(true);\n                const res = await _utils_axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(\"/v1/chat/messages/\".concat(chatId, \"?page=0&size=100\"));\n                setMessages(res.data.body || []);\n            } catch (err) {\n                console.error(\"❌ Lỗi tải tin nhắn:\", err);\n                setMessages([]);\n            } finally{\n                setLoading(false);\n            }\n        };\n        fetchMessages();\n    }, [\n        chatId,\n        currentUserId\n    ]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        var _clientRef_current;\n        if (!chatId || !currentUserId) return;\n        if (((_clientRef_current = clientRef.current) === null || _clientRef_current === void 0 ? void 0 : _clientRef_current.connected) && subscribedChatIdRef.current === chatId) return;\n        const client = (0,_utils_socket__WEBPACK_IMPORTED_MODULE_2__.createStompClient)();\n        clientRef.current = client;\n        client.onConnect = ()=>{\n            console.log(\"\\uD83D\\uDD0C Connected to WebSocket [chat:\".concat(chatId, \"]\"));\n            client.subscribe(\"/chat/\".concat(chatId), (message)=>{\n                try {\n                    var _data_sender, _data_sender1;\n                    const data = JSON.parse(message.body);\n                    console.log(\"\\uD83D\\uDCE9 Received:\", data);\n                    if (data.command === \"DELETE\") {\n                        setMessages((prev)=>prev.map((msg)=>msg.id === data.id ? {\n                                    ...msg,\n                                    content: \"[Tin nhắn đ\\xe3 bị x\\xf3a]\",\n                                    deleted: true\n                                } : msg));\n                        return;\n                    }\n                    if (data.command === \"EDIT\") {\n                        var _data_sender2;\n                        setMessages((prev)=>prev.map((msg)=>msg.id === data.id ? {\n                                    ...msg,\n                                    content: data.message,\n                                    edited: true,\n                                    editedAt: data.editedAt || new Date().toISOString()\n                                } : msg));\n                        if (((_data_sender2 = data.sender) === null || _data_sender2 === void 0 ? void 0 : _data_sender2.id) !== currentUserId) {\n                            (0,react_hot_toast__WEBPACK_IMPORTED_MODULE_3__.toast)(\"✏️ \".concat(data.sender.username, \" đ\\xe3 chỉnh sửa tin nhắn\"), {\n                                duration: 3000,\n                                position: \"top-right\"\n                            });\n                        }\n                        return;\n                    }\n                    // NEW MESSAGE\n                    const newMessage = {\n                        ...data,\n                        isOwnMessage: ((_data_sender = data.sender) === null || _data_sender === void 0 ? void 0 : _data_sender.id) === currentUserId\n                    };\n                    console.log(\"\\uD83D\\uDCE9 Processing new message:\", newMessage);\n                    console.log(\"\\uD83C\\uDD94 Current userId:\", currentUserId);\n                    console.log(\"\\uD83C\\uDD94 Sender ID:\", (_data_sender1 = data.sender) === null || _data_sender1 === void 0 ? void 0 : _data_sender1.id);\n                    // Cập nhật messages state\n                    setMessages((prev)=>{\n                        console.log(\"\\uD83D\\uDCDD Previous messages count:\", prev.length);\n                        const newMessages = [\n                            newMessage,\n                            ...prev\n                        ];\n                        console.log(\"\\uD83D\\uDCDD New messages count:\", newMessages.length);\n                        return newMessages;\n                    });\n                    // Cập nhật chatList ngay lập tức - không dùng state\n                    // Sử dụng requestAnimationFrame để đảm bảo DOM đã render\n                    requestAnimationFrame(()=>{\n                        updateChatList(newMessage);\n                    });\n                    if (data.sender && data.content && !newMessage.isOwnMessage) {\n                        (0,react_hot_toast__WEBPACK_IMPORTED_MODULE_3__.toast)(\"\\uD83D\\uDCAC \".concat(data.sender.username, \": \").concat(data.content), {\n                            duration: 4000,\n                            position: \"top-right\"\n                        });\n                    }\n                } catch (err) {\n                    console.error(\"❌ Error parsing message:\", err);\n                }\n            });\n            subscribedChatIdRef.current = chatId;\n            client.onDisconnect = ()=>{\n                console.warn(\"\\uD83D\\uDD0C Disconnected from WebSocket [chat:\".concat(chatId, \"]\"));\n                subscribedChatIdRef.current = null;\n            };\n            client.onStompError = (frame)=>{\n                console.error(\"❌ STOMP error:\", frame);\n            };\n            client.onWebSocketError = (err)=>{\n                console.error(\"❌ WebSocket error:\", err);\n            };\n        };\n        client.activate();\n        intervalRef.current = setInterval(()=>{\n            if (!client.connected && (0,_utils_axios__WEBPACK_IMPORTED_MODULE_1__.isTokenValid)()) {\n                console.log(\"\\uD83D\\uDD01 Reconnecting to chat:\".concat(chatId, \"...\"));\n                client.deactivate().then(()=>{\n                    const newClient = (0,_utils_socket__WEBPACK_IMPORTED_MODULE_2__.createStompClient)();\n                    clientRef.current = newClient;\n                    subscribedChatIdRef.current = null;\n                    newClient.onConnect = client.onConnect;\n                    newClient.activate();\n                });\n            } else {\n                console.log(\"[chat:\".concat(chatId, \"] Status: \").concat(client.connected ? \"✅ connected\" : \"❌ disconnected\"));\n            }\n        }, 15000);\n        return ()=>{\n            client.deactivate();\n            clearInterval(intervalRef.current);\n            subscribedChatIdRef.current = null;\n            console.log(\"❌ Cleaned up WebSocket [chat:\".concat(chatId, \"]\"));\n        };\n    }, [\n        chatId,\n        currentUserId\n    ]);\n    return {\n        messages,\n        loading,\n        currentUserId\n    };\n}\n_s(useChat, \"p6IPR72rh56zBBuYVabYBEsyhHw=\");\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T3FCLGdCQUFnQixHQUFHLENBQUN6QjtnQkFDekJ2QyxRQUFRd0MsS0FBSyxDQUFDLHNCQUFzQkQ7WUFDdEM7UUFDRjtRQUVBSSxPQUFPc0IsUUFBUTtRQUVmdkUsWUFBWStDLE9BQU8sR0FBR3lCLFlBQVk7WUFDaEMsSUFBSSxDQUFDdkIsT0FBT0QsU0FBUyxJQUFJOUQsMERBQVlBLElBQUk7Z0JBQ3ZDb0IsUUFBUUMsR0FBRyxDQUFDLHFDQUFrQyxPQUFQaEIsUUFBTztnQkFDOUMwRCxPQUFPd0IsVUFBVSxHQUFHQyxJQUFJLENBQUM7b0JBQ3ZCLE1BQU1DLFlBQVl4RixnRUFBaUJBO29CQUNuQ1csVUFBVWlELE9BQU8sR0FBRzRCO29CQUNwQjVFLG9CQUFvQmdELE9BQU8sR0FBRztvQkFDOUI0QixVQUFVekIsU0FBUyxHQUFHRCxPQUFPQyxTQUFTO29CQUN0Q3lCLFVBQVVKLFFBQVE7Z0JBQ3BCO1lBQ0YsT0FBTztnQkFDTGpFLFFBQVFDLEdBQUcsQ0FDVCxTQUE0QjBDLE9BQW5CMUQsUUFBTyxjQUFnRSxPQUFwRDBELE9BQU9ELFNBQVMsR0FBRyxnQkFBZ0I7WUFFbkU7UUFDRixHQUFHO1FBRUgsT0FBTztZQUNMQyxPQUFPd0IsVUFBVTtZQUNqQkcsY0FBYzVFLFlBQVkrQyxPQUFPO1lBQ2pDaEQsb0JBQW9CZ0QsT0FBTyxHQUFHO1lBQzlCekMsUUFBUUMsR0FBRyxDQUFDLGdDQUF1QyxPQUFQaEIsUUFBTztRQUNyRDtJQUNGLEdBQUc7UUFBQ0E7UUFBUUs7S0FBYztJQUUxQixPQUFPO1FBQUVKO1FBQVVFO1FBQVNFO0lBQWM7QUFDNUM7R0FuTndCTiIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9zcmMvaG9va3MvdXNlQ2hhdC5qcz84ZGE1Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xyXG5cclxuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlUmVmIH0gZnJvbSBcInJlYWN0XCI7XHJcbmltcG9ydCBhcGksIHsgaXNUb2tlblZhbGlkIH0gZnJvbSBcIkAvdXRpbHMvYXhpb3NcIjtcclxuaW1wb3J0IHsgY3JlYXRlU3RvbXBDbGllbnQgfSBmcm9tIFwiQC91dGlscy9zb2NrZXRcIjtcclxuaW1wb3J0IHsgdG9hc3QgfSBmcm9tIFwicmVhY3QtaG90LXRvYXN0XCI7XHJcbmltcG9ydCB1c2VBcHBTdG9yZSBmcm9tIFwiQC9zdG9yZS9adXN0YW5kU3RvcmVcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHVzZUNoYXQoY2hhdElkKSB7XHJcbiAgY29uc3QgW21lc3NhZ2VzLCBzZXRNZXNzYWdlc10gPSB1c2VTdGF0ZShbXSk7XHJcbiAgY29uc3QgW2xvYWRpbmcsIHNldExvYWRpbmddID0gdXNlU3RhdGUodHJ1ZSk7XHJcbiAgY29uc3QgW2N1cnJlbnRVc2VySWQsIHNldEN1cnJlbnRVc2VySWRdID0gdXNlU3RhdGUobnVsbCk7XHJcblxyXG4gIGNvbnN0IGNsaWVudFJlZiA9IHVzZVJlZihudWxsKTtcclxuICBjb25zdCBzdWJzY3JpYmVkQ2hhdElkUmVmID0gdXNlUmVmKG51bGwpO1xyXG4gIGNvbnN0IGludGVydmFsUmVmID0gdXNlUmVmKG51bGwpO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgY29uc3QgdWlkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJ1c2VySWRcIik7XHJcbiAgICBpZiAodWlkKSBzZXRDdXJyZW50VXNlcklkKHVpZCk7XHJcbiAgfSwgW10pO1xyXG5cclxuICAvLyBIw6BtIGhlbHBlciDEkeG7gyBj4bqtcCBuaOG6rXQgY2hhdExpc3RcclxuLy8gVHJvbmcgdXNlQ2hhdCBob29rLCBz4butYSB1cGRhdGVDaGF0TGlzdCBmdW5jdGlvbjpcclxuY29uc3QgdXBkYXRlQ2hhdExpc3QgPSAobmV3TWVzc2FnZSkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKFwi8J+UhCBQcm9jZXNzaW5nIG1lc3NhZ2UgZm9yIGNoYXRMaXN0OlwiLCBuZXdNZXNzYWdlKTtcclxuICBcclxuICBjb25zdCB7IGNoYXRMaXN0IH0gPSB1c2VBcHBTdG9yZS5nZXRTdGF0ZSgpO1xyXG4gIGNvbnNvbGUubG9nKFwi8J+TnCBDdXJyZW50IGNoYXRMaXN0OlwiLCBjaGF0TGlzdCk7XHJcbiAgXHJcbiAgY29uc3QgZm91bmRDaGF0ID0gY2hhdExpc3QuZmluZCgoYykgPT4gYy5jaGF0SWQgPT09IGNoYXRJZCk7XHJcbiAgY29uc29sZS5sb2coXCLwn5SNIEZvdW5kIGNoYXQ6XCIsIGZvdW5kQ2hhdCk7XHJcblxyXG4gIGlmIChmb3VuZENoYXQpIHtcclxuICAgIGNvbnNvbGUubG9nKFwi8J+UjSBDdXJyZW50IGxhdGVzdE1lc3NhZ2U6XCIsIGZvdW5kQ2hhdC5sYXRlc3RNZXNzYWdlKTsgLy8g4q2QIFPhu6xBIFTDik4gRklFTERcclxuICAgIGNvbnNvbGUubG9nKFwi8J+GlSBOZXcgbWVzc2FnZSBzdHJ1Y3R1cmU6XCIsIHtcclxuICAgICAgaWQ6IG5ld01lc3NhZ2UuaWQsXHJcbiAgICAgIGNvbnRlbnQ6IG5ld01lc3NhZ2UuY29udGVudCxcclxuICAgICAgc2VudEF0OiBuZXdNZXNzYWdlLnNlbnRBdCxcclxuICAgICAgc2VuZGVyOiBuZXdNZXNzYWdlLnNlbmRlclxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgdXBkYXRlZENoYXQgPSB7XHJcbiAgICAgIC4uLmZvdW5kQ2hhdCxcclxuICAgICAgLy8g4q2QIFPhu6xBIFThu6ogbGFzdE1lc3NhZ2UgVEjDgE5IIGxhdGVzdE1lc3NhZ2VcclxuICAgICAgbGF0ZXN0TWVzc2FnZToge1xyXG4gICAgICAgIGlkOiBuZXdNZXNzYWdlLmlkLFxyXG4gICAgICAgIGNvbnRlbnQ6IG5ld01lc3NhZ2UuY29udGVudCxcclxuICAgICAgICBzZW50QXQ6IG5ld01lc3NhZ2Uuc2VudEF0LFxyXG4gICAgICAgIHNlbmRlcjogbmV3TWVzc2FnZS5zZW5kZXIsXHJcbiAgICAgICAgbWVzc2FnZVR5cGU6IG5ld01lc3NhZ2UubWVzc2FnZVR5cGUsXHJcbiAgICAgICAgYXR0YWNobWVudDogbmV3TWVzc2FnZS5hdHRhY2htZW50LFxyXG4gICAgICAgIGF0dGFjaG1lbnRzOiBuZXdNZXNzYWdlLmF0dGFjaG1lbnRzLFxyXG4gICAgICAgIGRlbGV0ZWQ6IG5ld01lc3NhZ2UuZGVsZXRlZCB8fCBmYWxzZVxyXG4gICAgICB9LFxyXG4gICAgICB1cGRhdGVkQXQ6IG5ld01lc3NhZ2Uuc2VudEF0LFxyXG4gICAgICBub3RSZWFkTWVzc2FnZUNvdW50OlxyXG4gICAgICAgIChmb3VuZENoYXQubm90UmVhZE1lc3NhZ2VDb3VudCB8fCAwKSArIChuZXdNZXNzYWdlLmlzT3duTWVzc2FnZSA/IDAgOiAxKSxcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKFwi8J+GlSBVcGRhdGVkQ2hhdCBsYXRlc3RNZXNzYWdlOlwiLCB1cGRhdGVkQ2hhdC5sYXRlc3RNZXNzYWdlKTtcclxuICAgIFxyXG4gICAgY29uc3Qgb3RoZXJDaGF0cyA9IGNoYXRMaXN0LmZpbHRlcigoYykgPT4gYy5jaGF0SWQgIT09IGNoYXRJZCk7XHJcbiAgICBjb25zdCBuZXdDaGF0TGlzdCA9IFsuLi5vdGhlckNoYXRzLCB1cGRhdGVkQ2hhdF0uc29ydChcclxuICAgICAgKGEsIGIpID0+IG5ldyBEYXRlKGIudXBkYXRlZEF0KS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShhLnVwZGF0ZWRBdCkuZ2V0VGltZSgpXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFwi8J+TnCBOZXcgY2hhdExpc3QgZmlyc3QgaXRlbSBsYXRlc3RNZXNzYWdlOlwiLCBuZXdDaGF0TGlzdFswXT8ubGF0ZXN0TWVzc2FnZSk7XHJcbiAgICBcclxuICAgIC8vIEZvcmNlIHVwZGF0ZSBi4bqxbmcgY8OhY2ggdOG6oW8gb2JqZWN0IG3hu5tpIGhvw6BuIHRvw6BuXHJcbiAgICB1c2VBcHBTdG9yZS5zZXRTdGF0ZSh7IFxyXG4gICAgICBjaGF0TGlzdDogbmV3Q2hhdExpc3QubWFwKGNoYXQgPT4gKHsuLi5jaGF0fSkpXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coXCLinIUgQ2hhdExpc3QgdXBkYXRlZCBzdWNjZXNzZnVsbHkhXCIpO1xyXG4gICAgXHJcbiAgICAvLyBWZXJpZnkgdXBkYXRlXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgY29uc3QgeyBjaGF0TGlzdDogdXBkYXRlZExpc3QgfSA9IHVzZUFwcFN0b3JlLmdldFN0YXRlKCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+UjSBWZXJpZmllZCBsYXRlc3RNZXNzYWdlIGFmdGVyIHVwZGF0ZTpcIiwgdXBkYXRlZExpc3QuZmluZChjID0+IGMuY2hhdElkID09PSBjaGF0SWQpPy5sYXRlc3RNZXNzYWdlKTtcclxuICAgIH0sIDEwMCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnNvbGUud2Fybihg4pqg77iPIEtow7RuZyB0w6xtIHRo4bqleSBjaGF0IHbhu5tpIGNoYXRJZDogJHtjaGF0SWR9YCk7XHJcbiAgfVxyXG59O1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKCFjaGF0SWQpIHJldHVybjtcclxuICAgIGNvbnN0IGZldGNoTWVzc2FnZXMgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgc2V0TG9hZGluZyh0cnVlKTtcclxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBhcGkuZ2V0KGAvdjEvY2hhdC9tZXNzYWdlcy8ke2NoYXRJZH0/cGFnZT0wJnNpemU9MTAwYCk7XHJcbiAgICAgICAgc2V0TWVzc2FnZXMocmVzLmRhdGEuYm9keSB8fCBbXSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgTOG7l2kgdOG6o2kgdGluIG5o4bqvbjpcIiwgZXJyKTtcclxuICAgICAgICBzZXRNZXNzYWdlcyhbXSk7XHJcbiAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgc2V0TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBmZXRjaE1lc3NhZ2VzKCk7XHJcbiAgfSwgW2NoYXRJZCwgY3VycmVudFVzZXJJZF0pO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgaWYgKCFjaGF0SWQgfHwgIWN1cnJlbnRVc2VySWQpIHJldHVybjtcclxuXHJcbiAgICBpZiAoY2xpZW50UmVmLmN1cnJlbnQ/LmNvbm5lY3RlZCAmJiBzdWJzY3JpYmVkQ2hhdElkUmVmLmN1cnJlbnQgPT09IGNoYXRJZCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IGNsaWVudCA9IGNyZWF0ZVN0b21wQ2xpZW50KCk7XHJcbiAgICBjbGllbnRSZWYuY3VycmVudCA9IGNsaWVudDtcclxuXHJcbiAgICBjbGllbnQub25Db25uZWN0ID0gKCkgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhg8J+UjCBDb25uZWN0ZWQgdG8gV2ViU29ja2V0IFtjaGF0OiR7Y2hhdElkfV1gKTtcclxuXHJcbiAgICAgIGNsaWVudC5zdWJzY3JpYmUoYC9jaGF0LyR7Y2hhdElkfWAsIChtZXNzYWdlKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKG1lc3NhZ2UuYm9keSk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIvCfk6kgUmVjZWl2ZWQ6XCIsIGRhdGEpO1xyXG5cclxuICAgICAgICAgIGlmIChkYXRhLmNvbW1hbmQgPT09IFwiREVMRVRFXCIpIHtcclxuICAgICAgICAgICAgc2V0TWVzc2FnZXMoKHByZXYpID0+XHJcbiAgICAgICAgICAgICAgcHJldi5tYXAoKG1zZykgPT5cclxuICAgICAgICAgICAgICAgIG1zZy5pZCA9PT0gZGF0YS5pZCA/IHsgLi4ubXNnLCBjb250ZW50OiBcIltUaW4gbmjhuq9uIMSRw6MgYuG7iyB4w7NhXVwiLCBkZWxldGVkOiB0cnVlIH0gOiBtc2dcclxuICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoZGF0YS5jb21tYW5kID09PSBcIkVESVRcIikge1xyXG4gICAgICAgICAgICBzZXRNZXNzYWdlcygocHJldikgPT5cclxuICAgICAgICAgICAgICBwcmV2Lm1hcCgobXNnKSA9PlxyXG4gICAgICAgICAgICAgICAgbXNnLmlkID09PSBkYXRhLmlkXHJcbiAgICAgICAgICAgICAgICAgID8geyAuLi5tc2csIGNvbnRlbnQ6IGRhdGEubWVzc2FnZSwgZWRpdGVkOiB0cnVlLCBlZGl0ZWRBdDogZGF0YS5lZGl0ZWRBdCB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfVxyXG4gICAgICAgICAgICAgICAgICA6IG1zZ1xyXG4gICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkYXRhLnNlbmRlcj8uaWQgIT09IGN1cnJlbnRVc2VySWQpIHtcclxuICAgICAgICAgICAgICB0b2FzdChg4pyP77iPICR7ZGF0YS5zZW5kZXIudXNlcm5hbWV9IMSRw6MgY2jhu4luaCBz4butYSB0aW4gbmjhuq9uYCwge1xyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDMwMDAsXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJ0b3AtcmlnaHRcIixcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gTkVXIE1FU1NBR0VcclxuICAgICAgICAgIGNvbnN0IG5ld01lc3NhZ2UgPSB7IC4uLmRhdGEsIGlzT3duTWVzc2FnZTogZGF0YS5zZW5kZXI/LmlkID09PSBjdXJyZW50VXNlcklkIH07XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIvCfk6kgUHJvY2Vzc2luZyBuZXcgbWVzc2FnZTpcIiwgbmV3TWVzc2FnZSk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIvCfhpQgQ3VycmVudCB1c2VySWQ6XCIsIGN1cnJlbnRVc2VySWQpO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCLwn4aUIFNlbmRlciBJRDpcIiwgZGF0YS5zZW5kZXI/LmlkKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gQ+G6rXAgbmjhuq10IG1lc3NhZ2VzIHN0YXRlXHJcbiAgICAgICAgICBzZXRNZXNzYWdlcygocHJldikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIvCfk50gUHJldmlvdXMgbWVzc2FnZXMgY291bnQ6XCIsIHByZXYubGVuZ3RoKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3TWVzc2FnZXMgPSBbbmV3TWVzc2FnZSwgLi4ucHJldl07XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi8J+TnSBOZXcgbWVzc2FnZXMgY291bnQ6XCIsIG5ld01lc3NhZ2VzLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXdNZXNzYWdlcztcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBD4bqtcCBuaOG6rXQgY2hhdExpc3QgbmdheSBs4bqtcCB04bupYyAtIGtow7RuZyBkw7luZyBzdGF0ZVxyXG4gICAgICAgICAgLy8gU+G7rSBk4bulbmcgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIMSR4buDIMSR4bqjbSBi4bqjbyBET00gxJHDoyByZW5kZXJcclxuICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHVwZGF0ZUNoYXRMaXN0KG5ld01lc3NhZ2UpO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgaWYgKGRhdGEuc2VuZGVyICYmIGRhdGEuY29udGVudCAmJiAhbmV3TWVzc2FnZS5pc093bk1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdG9hc3QoYPCfkqwgJHtkYXRhLnNlbmRlci51c2VybmFtZX06ICR7ZGF0YS5jb250ZW50fWAsIHtcclxuICAgICAgICAgICAgICBkdXJhdGlvbjogNDAwMCxcclxuICAgICAgICAgICAgICBwb3NpdGlvbjogXCJ0b3AtcmlnaHRcIixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIHBhcnNpbmcgbWVzc2FnZTpcIiwgZXJyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgc3Vic2NyaWJlZENoYXRJZFJlZi5jdXJyZW50ID0gY2hhdElkO1xyXG5cclxuICAgICAgY2xpZW50Lm9uRGlzY29ubmVjdCA9ICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLndhcm4oYPCflIwgRGlzY29ubmVjdGVkIGZyb20gV2ViU29ja2V0IFtjaGF0OiR7Y2hhdElkfV1gKTtcclxuICAgICAgICBzdWJzY3JpYmVkQ2hhdElkUmVmLmN1cnJlbnQgPSBudWxsO1xyXG4gICAgICB9O1xyXG4gICAgICBjbGllbnQub25TdG9tcEVycm9yID0gKGZyYW1lKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBTVE9NUCBlcnJvcjpcIiwgZnJhbWUpO1xyXG4gICAgICB9O1xyXG4gICAgICBjbGllbnQub25XZWJTb2NrZXRFcnJvciA9IChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwi4p2MIFdlYlNvY2tldCBlcnJvcjpcIiwgZXJyKTtcclxuICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgY2xpZW50LmFjdGl2YXRlKCk7XHJcblxyXG4gICAgaW50ZXJ2YWxSZWYuY3VycmVudCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgaWYgKCFjbGllbnQuY29ubmVjdGVkICYmIGlzVG9rZW5WYWxpZCgpKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYPCflIEgUmVjb25uZWN0aW5nIHRvIGNoYXQ6JHtjaGF0SWR9Li4uYCk7XHJcbiAgICAgICAgY2xpZW50LmRlYWN0aXZhdGUoKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGNvbnN0IG5ld0NsaWVudCA9IGNyZWF0ZVN0b21wQ2xpZW50KCk7XHJcbiAgICAgICAgICBjbGllbnRSZWYuY3VycmVudCA9IG5ld0NsaWVudDtcclxuICAgICAgICAgIHN1YnNjcmliZWRDaGF0SWRSZWYuY3VycmVudCA9IG51bGw7XHJcbiAgICAgICAgICBuZXdDbGllbnQub25Db25uZWN0ID0gY2xpZW50Lm9uQ29ubmVjdDtcclxuICAgICAgICAgIG5ld0NsaWVudC5hY3RpdmF0ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgICAgYFtjaGF0OiR7Y2hhdElkfV0gU3RhdHVzOiAke2NsaWVudC5jb25uZWN0ZWQgPyBcIuKchSBjb25uZWN0ZWRcIiA6IFwi4p2MIGRpc2Nvbm5lY3RlZFwifWBcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9LCAxNTAwMCk7XHJcblxyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgY2xpZW50LmRlYWN0aXZhdGUoKTtcclxuICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbFJlZi5jdXJyZW50KTtcclxuICAgICAgc3Vic2NyaWJlZENoYXRJZFJlZi5jdXJyZW50ID0gbnVsbDtcclxuICAgICAgY29uc29sZS5sb2coYOKdjCBDbGVhbmVkIHVwIFdlYlNvY2tldCBbY2hhdDoke2NoYXRJZH1dYCk7XHJcbiAgICB9O1xyXG4gIH0sIFtjaGF0SWQsIGN1cnJlbnRVc2VySWRdKTtcclxuXHJcbiAgcmV0dXJuIHsgbWVzc2FnZXMsIGxvYWRpbmcsIGN1cnJlbnRVc2VySWQgfTtcclxufSJdLCJuYW1lcyI6WyJ1c2VFZmZlY3QiLCJ1c2VTdGF0ZSIsInVzZVJlZiIsImFwaSIsImlzVG9rZW5WYWxpZCIsImNyZWF0ZVN0b21wQ2xpZW50IiwidG9hc3QiLCJ1c2VBcHBTdG9yZSIsInVzZUNoYXQiLCJjaGF0SWQiLCJtZXNzYWdlcyIsInNldE1lc3NhZ2VzIiwibG9hZGluZyIsInNldExvYWRpbmciLCJjdXJyZW50VXNlcklkIiwic2V0Q3VycmVudFVzZXJJZCIsImNsaWVudFJlZiIsInN1YnNjcmliZWRDaGF0SWRSZWYiLCJpbnRlcnZhbFJlZiIsInVpZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJ1cGRhdGVDaGF0TGlzdCIsIm5ld01lc3NhZ2UiLCJjb25zb2xlIiwibG9nIiwiY2hhdExpc3QiLCJnZXRTdGF0ZSIsImZvdW5kQ2hhdCIsImZpbmQiLCJjIiwibmV3Q2hhdExpc3QiLCJsYXRlc3RNZXNzYWdlIiwiaWQiLCJjb250ZW50Iiwic2VudEF0Iiwic2VuZGVyIiwidXBkYXRlZENoYXQiLCJtZXNzYWdlVHlwZSIsImF0dGFjaG1lbnQiLCJhdHRhY2htZW50cyIsImRlbGV0ZWQiLCJ1cGRhdGVkQXQiLCJub3RSZWFkTWVzc2FnZUNvdW50IiwiaXNPd25NZXNzYWdlIiwib3RoZXJDaGF0cyIsImZpbHRlciIsInNvcnQiLCJhIiwiYiIsIkRhdGUiLCJnZXRUaW1lIiwic2V0U3RhdGUiLCJtYXAiLCJjaGF0Iiwic2V0VGltZW91dCIsInVwZGF0ZWRMaXN0Iiwid2FybiIsImZldGNoTWVzc2FnZXMiLCJyZXMiLCJnZXQiLCJkYXRhIiwiYm9keSIsImVyciIsImVycm9yIiwiY3VycmVudCIsImNvbm5lY3RlZCIsImNsaWVudCIsIm9uQ29ubmVjdCIsInN1YnNjcmliZSIsIm1lc3NhZ2UiLCJKU09OIiwicGFyc2UiLCJjb21tYW5kIiwicHJldiIsIm1zZyIsImVkaXRlZCIsImVkaXRlZEF0IiwidG9JU09TdHJpbmciLCJ1c2VybmFtZSIsImR1cmF0aW9uIiwicG9zaXRpb24iLCJsZW5ndGgiLCJuZXdNZXNzYWdlcyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm9uRGlzY29ubmVjdCIsIm9uU3RvbXBFcnJvciIsImZyYW1lIiwib25XZWJTb2NrZXRFcnJvciIsImFjdGl2YXRlIiwic2V0SW50ZXJ2YWwiLCJkZWFjdGl2YXRlIiwidGhlbiIsIm5ld0NsaWVudCIsImNsZWFySW50ZXJ2YWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(app-pages-browser)/./src/hooks/useChat.js\n"));

/***/ })

});